#!/bin/bash


SERVER=$(gum choose "Dedicated_IP" "p2p" "Switzerland" "United_States")

# TODO: Allow "Other..." as a choice above and open full countries list:
# SERVER=$(nordvpn countries | sed 's/ \+/\'$'\n''/g' | gum choose)

[[ $SERVER == "" ]] && echo "Exiting..." && exit 1

# NOTE: I clearly have no idea what [[]] and [] are doing.
#       Something to do with a "sub-shell".
#       I think the below conditionals might be incorrect,
#       though they are working.

if [ $SERVER != "p2p" ]; then
  systemctl stop jackett.service
	transmission-remote --exit
fi

# echo -e "Connecting to $SERVER..."
nordvpn connect $SERVER

if [ $SERVER == "p2p" ]; then
  echo "Starting Transmission daemon..."
  transmission-daemon
  
  # We're also going to start the Jackett search/indexing service
  # NOTE: This requires additional permissions - to allow the user
  # to initiate the action without a password, a Polkit rule needs
  # to be created: https://wiki.archlinux.org/title/Polkit#Allow_a_user_to_use_the_org.freedesktop.timedate1.set-timezone_action
  systemctl start jackett.service

  # TODO: We should ask whether we want to search (using `raincoat [search term]`)
  #       or view active torrents (using `stig` as below).
  stig
fi
